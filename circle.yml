# We build AMIs using packer, using the packer-ami-builder user
machine:
  timezone: America/Los_Angeles

dependencies:
  cache_directories:
    - /home/ubuntu/bin
  pre:
    - mkdir -p /home/ubuntu/bin
    - [ ! -d /home/ubuntu/bin/packer ] \&\& curl --location -O https://dl.bintray.com/mitchellh/packer/packer_0.8.2_linux_amd64.zip
    - [ ! -d /home/ubuntu/bin/packer ] \&\& unzip -d /home/ubuntu/bin packer_0.8.2_linux_amd64.zip

test:
  override:
    - cd ~/empire_ami && packer -machine-readable build -color=false ./packer.json | tee -a $CIRCLE_ARTIFACTS/packer.out
